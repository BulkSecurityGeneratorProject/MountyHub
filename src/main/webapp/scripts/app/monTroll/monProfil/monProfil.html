<jh-alert-error></jh-alert-error>
<jh-alert></jh-alert>
<div class="row" ng-show="!troll.name">
    <div class="container-fluid">
        <h4>
            Vous n'avez pas de Troll associé à votre compte.
            <br>
            <br>
            Vous devez tout d'abord en ajouter un afin d'utiliser pleinement MountyHub !
        </h4>
    </div>
    <div class="col-md-4">
        <div class="form-group">
            <label for="number">Numéro du troll</label>
            <input type="text" class="form-control" id="number" ng-model="troll.number">
        </div>
        <div class="form-group">
            <label for="restrictedPassword">Mot de passe restreint</label>
            <input type="password" class="form-control" id="restrictedPassword" ng-model="troll.restrictedPassword">
        </div>
        <button class="btn btn-primary" ng-click="addTroll()">Ajouter mon troll</button>
    </div>
</div>
<div class="row" ng-show="troll.name">
    <h1 class="text-center">{{troll.name}} <a
        href="http://games.mountyhall.com/mountyhall/View/PJView.php?ai_IDPJ={{troll.number}}"
        target="_blank">{{troll.number}}</a></h1>
    <h3 class="text-center">{{troll.race}} niveau {{troll.level}} né le {{troll.birthDateFormatted}}</h3>
    <div class="row">
        <div class="col-md-6">
            <h4 class="text-center">Caractéristiques <span class="glyphicon glyphicon-refresh" aria-hidden="true"
                                                           ng-click="refreshProfil($event, 'characteristic')"
                                                           uib-tooltip="Mis à jour il y a {{troll.scriptCallLastCall.SP_Caract}}"></span>
            </h4>
            <table class="table" style="background-color: white">
                <tr>
                    <th>Nom</th>
                    <th class="text-center">Base</th>
                    <th class="text-center">Physique</th>
                    <th class="text-center">Magique</th>
                    <th class="text-center">Total (moy.)</th>
                </tr>
                <tr ng-repeat="carac in caracs">
                    <td>{{carac.n}}</td>
                    <td class="text-center">{{troll[carac.p]}}{{carac.d}}</td>
                    <td class="text-center{{addContext(troll[carac.p + 'P'])}}">{{addSign(troll[carac.p + 'P'])}}</td>
                    <td class="text-center{{addContext(troll[carac.p + 'M'])}}">{{addSign(troll[carac.p + 'M'])}}</td>
                    <td class="text-center">{{carac.a(troll[carac.p], troll[carac.p + 'P'], troll[carac.p +
                        'M'])}}{{carac.s
                        ? carac.d : ''}}
                    </td>
                </tr>
            </table>
        </div>
        <div class="col-md-4">
            <h4 class="text-center">État <span class="glyphicon glyphicon-refresh" aria-hidden="true"
                                               ng-click="refreshProfil($event, 'state')"
                                               uib-tooltip="Mis à jour il y a {{troll.scriptCallLastCall.SP_Profil2}}"></span>
            </h4>
            <uib-progressbar value="troll.currentHitPoint"
                             max="troll.totalHitPoint"
                             type="{{troll.currentHitPoint > troll.totalHitPoint * 0.66 ? 'success' : troll.currentHitPoint > troll.totalHitPoint * 0.33 ? 'warning' : 'danger'}}">
                {{troll.currentHitPoint}} / {{troll.totalHitPoint}} PV
            </uib-progressbar>
            <p class="text-center" style="margin-bottom: 5px;">
                <span class="label label-danger" ng-if="troll.hidden">Camouflé</span>
                <span class="label label-danger" ng-if="troll.invisible">Invisible</span>
                <span class="label label-danger" ng-if="troll.intangible">Intangible</span>
            </p>
            <p class="text-center"><strong>X = {{troll.x}} | Y = {{troll.y}} | Z = {{troll.z}}</strong></p>
            <p ng-if="troll.protection">Protection : <strong>{{troll.protection}}</strong></p>
            <table class="table" style="background-color: white">
                <tr>
                    <td>DLA</td>
                    <td class="text-right"><strong>{{troll.dla}}</strong></td>
                </tr>
                <tr>
                    <td>Estimation DLA suivante</td>
                    <td class="text-right"><strong>{{troll.nextDla}}</strong></td>
                </tr>
                <tr>
                    <td>Durée tour</td>
                    <td class="text-right">{{troll.turnFormatted}}</td>
                </tr>
                <tr ng-if="troll.weightTimeFormatted">
                    <td>Poids équipement</td>
                    <td class="text-right">{{troll.weightTimeFormatted}}</td>
                </tr>
                <tr ng-if="troll.bonusMalusTimeFormatted">
                    <td>Durée bonus/malus</td>
                    <td class="text-right">{{troll.bonusMalusTimeFormatted}}</td>
                </tr>
                <tr ng-if="troll.woundsTimeFormatted">
                    <td>Durée due aux blessures</td>
                    <td class="text-right">{{troll.woundsTimeFormatted}}</td>
                </tr>
                <tr>
                    <td>Durée tour total</td>
                    <td class="text-right">{{troll.turnTotalFormatted}}</td>
                </tr>
            </table>
        </div>
        <div class="col-md-2">
            <h4 class="text-center">Appel scripts (24H)</h4>
            <table class="table" style="background-color: white">
                <tr>
                    <th>Nom</th>
                    <th class="text-center">Compteur</th>
                </tr>
                <tr>
                    <td>Dynamique</td>
                    <td class="text-center">{{troll.scriptCallByDay.DYNAMIQUE || 0}}</td>
                </tr>
                <tr>
                    <td>Statique</td>
                    <td class="text-center">{{troll.scriptCallByDay.STATIQUE || 0}}</td>
                </tr>
                <tr>
                    <td>Message</td>
                    <td class="text-center">{{troll.scriptCallByDay.MESSAGE || 0}}</td>
                </tr>
                <tr>
                    <td>Appel</td>
                    <td class="text-center">{{troll.scriptCallByDay.APPEL || 0}}</td>
                </tr>
            </table>
        </div>
    </div>
    <div class="row" style="margin: 0">
        <div class="col-md-6 part">
            <div class="part-header" data-toggle="collapse" href="#comps">
                <h4 class="text-center">{{competences.length}} Compétences <span class="glyphicon glyphicon-refresh"
                                                                                 aria-hidden="true"
                                                                                 ng-click="refreshProfil($event, 'compAndSpell')"
                                                                                 uib-tooltip="Mis à jour il y a {{troll.scriptCallLastCall.SP_Aptitudes2}}"></span>
                </h4>
            </div>
            <div class="collapse" id="comps">
                <table class="table">
                    <tr>
                        <th>Nom</th>
                        <th class="text-center">Niveau</th>
                        <th class="text-center">Maîtrise</th>
                    </tr>
                    <tr ng-repeat="competence in troll.aptitudes | filter:{type:'C'} as competences"
                        uib-tooltip="{{competence.tooltip}}">
                        <td>{{competence.name}}</td>
                        <td class="text-center">{{competence.level}}</td>
                        <td class="text-center">{{competence.percent}}%</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="col-md-6 part pull-right">
            <div class="part-header" data-toggle="collapse" href="#spells">
                <h4 class="text-center">{{spells.length}} Sortilèges <span class="glyphicon glyphicon-refresh"
                                                                           aria-hidden="true"
                                                                           ng-click="refreshProfil($event, 'compAndSpell')"
                                                                           uib-tooltip="Mis à jour il y a {{troll.scriptCallLastCall.SP_Aptitudes2}}"></span>
                </h4>
            </div>
            <div class="collapse" id="spells">
                <table class="table">
                    <tr>
                        <th>Nom</th>
                        <th class="text-center">Niveau</th>
                        <th class="text-center">Maîtrise</th>
                    </tr>
                    <tr ng-repeat="spell in troll.aptitudes | filter:{type:'S'} as spells"
                        uib-tooltip="{{spell.tooltip}}">
                        <td>{{spell.name}}</td>
                        <td class="text-center">{{spell.level}}</td>
                        <td class="text-center">{{spell.percent}}%</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-12 part">
        <div class="part-header" data-toggle="collapse" href="#gear">
            <h4 class="text-center">{{troll.gears.length}} Objets <span class="glyphicon glyphicon-refresh"
                                                                        aria-hidden="true"
                                                                        ng-click="refreshProfil($event, 'gear')"
                                                                        uib-tooltip="Mis à jour il y a {{troll.scriptCallLastCall.SP_Equipement}}"></span>
            </h4>
            <h6 class="text-center">{{troll.gearEffect}}</h6>
        </div>
        <div class="collapse" id="gear">
            <table class="table" style="background-color: white">
                <tr>
                    <th class="text-center">Equipé</th>
                    <th>Type</th>
                    <th>Nom</th>
                    <th>Effet</th>
                    <th>Poids</th>
                </tr>
                <tr ng-repeat="gear in troll.gears | filter:{wore:true}">
                    <td class="text-center"><span class="glyphicon glyphicon-ok"></span></td>
                    <td>{{gear.type}}</td>
                    <td>{{gear.name}} {{gear.template}}</td>
                    <td>{{gear.description}}</td>
                    <td>{{gear.weight}} min</td>
                </tr>
                <tr ng-repeat="gear in troll.gears | filter:{wore:false}">
                    <td class="text-center"><span class="glyphicon glyphicon-remove"></span></td>
                    <td>{{gear.type}}</td>
                    <td>{{gear.name}} {{gear.template}}</td>
                    <td>{{gear.description}}</td>
                    <td>{{gear.weight}} min</td>
                </tr>
            </table>
        </div>
    </div>
    <div class="col-md-6 part">
        <div class="part-header" data-toggle="collapse" href="#flies">
            <h4 class="text-center">{{troll.flies.length}} Mouches <span class="glyphicon glyphicon-refresh"
                                                                         aria-hidden="true"
                                                                         ng-click="refreshProfil($event, 'fly')"
                                                                         uib-tooltip="Mis à jour il y a {{troll.scriptCallLastCall.SP_Mouche}}"></span>
            </h4>
            <h6 class="text-center">{{troll.flyEffect}}</h6>
        </div>
        <div class="collapse" id="flies">
            <table class="table" style="background-color: white">
                <tr>
                    <th class="text-center">Présente</th>
                    <th>Type</th>
                    <th>Nom</th>
                    <th>Effet</th>
                </tr>
                <tr ng-repeat="fly in troll.flies">
                    <td class="text-center"><span class="glyphicon glyphicon-{{fly.here ? 'ok' : 'remove'}}"></span>
                    </td>
                    <td>{{fly.type | capitalize}}</td>
                    <td>{{fly.name}}</td>
                    <td>{{fly.effect}}</td>
                </tr>
            </table>
        </div>
    </div>
    <div class="col-md-6 part">
        <div class="part-header" data-toggle="collapse" href="#bonusMalus">
            <h4 class="text-center">{{troll.bonusMalus.length}} Bonus/Malus <span class="glyphicon glyphicon-refresh"
                                                                                  aria-hidden="true"
                                                                                  ng-click="refreshProfil($event, 'bonusMalus')"
                                                                                  uib-tooltip="Mis à jour il y a {{troll.scriptCallLastCall.SP_Bonusmalus}}"></span>
            </h4>
            <h6 class="text-center">{{troll.bonusMalusEffect}}</h6>
        </div>
        <div class="collapse" id="bonusMalus">
            <table class="table" style="background-color: white">
                <tr>
                    <th>Nom</th>
                    <th>Type</th>
                    <th>Effet théorique</th>
                    <th>Effet réel</th>
                    <th class="text-center">Durée</th>
                </tr>
                <tr ng-repeat="bonusMalus in troll.bonusMalus">
                    <td>{{bonusMalus.name}}</td>
                    <td>{{bonusMalus.type | capitalize}}</td>
                    <td>{{bonusMalus.effect}}</td>
                    <td>{{bonusMalus.realEffect}}</td>
                    <td class="text-center">{{bonusMalus.duration}}</td>
                </tr>
            </table>
        </div>
    </div>
    <div class="col-md-12">
        <h4 class="text-center">Divers</h4>
        <label>
            Fuseau horaire :
            <select ng-model="troll.userOptions.ZONEID.value" ng-change="updateTimezone()">
                <option ng-repeat="timezone in timezones" value="{{timezone}}">{{timezone}}</option>
            </select>
        </label>
        <button class="btn btn-danger" ng-click="deleteTroll()">Supprimer mon troll</button>
    </div>
</div>
